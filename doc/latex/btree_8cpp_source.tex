\doxysection{btree.\+cpp}
\hypertarget{btree_8cpp_source}{}\label{btree_8cpp_source}\index{src/btree.cpp@{src/btree.cpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <iterator>}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <algorithm>}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <stdexcept>}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <format>}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}btree.h"{}}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#ifdef\ BTREE\_ENABLE\_JSON}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <nlohmann/json.hpp>}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ <sstream>}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ <iomanip>}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ <functional>}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00020\ \mbox{\hyperlink{struct_b_tree_1_1_node_ac96ca8a83369119de34217b4e1b555ce}{BTree<Key,\ Value,\ Compare>::Node::Node}}(\textcolor{keywordtype}{bool}\ leaf)}
\DoxyCodeLine{00021\ \ \ \ \ :\ isLeaf(leaf),}
\DoxyCodeLine{00022\ \ \ \ \ nextLeaf(nullptr),}
\DoxyCodeLine{00023\ \ \ \ \ prevLeaf(nullptr)}
\DoxyCodeLine{00024\ \{}
\DoxyCodeLine{00025\ \ \ \ \ \textcolor{keywordflow}{if}\ (!isLeaf)\ \{}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ keys.reserve(2\ *\ \mbox{\hyperlink{class_b_tree_aa466823af040ada3f5a56574e337a526}{BTree::s\_CAPACITY}}\ -\/\ 1);}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ children.reserve(2\ *\ \mbox{\hyperlink{class_b_tree_aa466823af040ada3f5a56574e337a526}{BTree::s\_CAPACITY}});}
\DoxyCodeLine{00028\ \ \ \ \ \}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \ \ \ \ entries.reserve(2\ *\ \mbox{\hyperlink{class_b_tree_aa466823af040ada3f5a56574e337a526}{BTree::s\_CAPACITY}}\ -\/\ 1);}
\DoxyCodeLine{00031\ \ \}}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00034\ \mbox{\hyperlink{class_b_tree_ac7841baccc584bd46c5ddbaa269c7c69}{BTree<Key,\ Value,\ Compare>::BTree}}(\textcolor{keyword}{const}\ Compare\&\ comp)\ :\ m\_Comp(std::move(comp)),\ m\_Size(0)}
\DoxyCodeLine{00035\ \{}
\DoxyCodeLine{00036\ \ \ \ \ m\_Root\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}(\textcolor{keyword}{true});}
\DoxyCodeLine{00037\ \}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00040\ \mbox{\hyperlink{class_b_tree_a6539ce4056146a8bfdfb9cac1e31cac6}{BTree<Key,\ Value,\ Compare>::\string~BTree}}()}
\DoxyCodeLine{00041\ \{}
\DoxyCodeLine{00042\ \ \ \ \ \mbox{\hyperlink{class_b_tree_a5dcf22843ae0428dfc1dc6e108955c06}{destroyNode}}(m\_Root);}
\DoxyCodeLine{00043\ \}}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00046\ Value\&\ \mbox{\hyperlink{class_b_tree_adfb513daae74e467d51c9bf88af2596a}{BTree<Key,\ Value,\ Compare>::operator[]}}(\textcolor{keyword}{const}\ Key\ \&key)}
\DoxyCodeLine{00047\ \{}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keywordflow}{if}\ (Value*\ p\ =\ \mbox{\hyperlink{class_b_tree_a6ac491a77f862fa00a94cf7a688d7e48}{search}}(key))\ \{}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \ *p;}
\DoxyCodeLine{00050\ \ \ \ \ \}}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keywordflow}{throw}\ std::out\_of\_range(std::format(\textcolor{stringliteral}{"{}BTree[]\ lookup\ failed:\ key\ \{\}\ not\ found"{}},\ key));}
\DoxyCodeLine{00053\ \}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00056\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{class_b_tree_a4a1d1d6517f181018efa489d009d0fcc}{BTree<Key,\ Value,\ Compare>::size}}()\textcolor{keyword}{\ const}}
\DoxyCodeLine{00057\ \textcolor{keyword}{}\{}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keywordflow}{return}\ m\_Size;}
\DoxyCodeLine{00059\ \}}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00062\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_b_tree_a5dcf22843ae0428dfc1dc6e108955c06}{BTree<Key,\ Value,\ Compare>::destroyNode}}(\mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}\ *node)}
\DoxyCodeLine{00063\ \{}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keywordflow}{if}\ (!node)\ \{}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00066\ \ \ \ \ \}}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}*\ child\ :\ node-\/>children)\ \{}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_b_tree_a5dcf22843ae0428dfc1dc6e108955c06}{destroyNode}}(child);}
\DoxyCodeLine{00070\ \ \ \ \ \}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keyword}{delete}\ node;}
\DoxyCodeLine{00073\ \}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00076\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_b_tree_a644946dc5c2b58a1c7ddf8d52fa1b2e8}{BTree<Key,\ Value,\ Compare>::splitChild}}(\mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}*\ parent,\ \textcolor{keywordtype}{size\_t}\ index)}
\DoxyCodeLine{00077\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}*\ child\ =\ parent-\/>children[index];}
\DoxyCodeLine{00079\ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}*\ sibling\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}(child-\/>isLeaf);}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keywordflow}{if}\ (child-\/>isLeaf)\ \{}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ midIt\ =\ child-\/>entries.begin()\ +\ \mbox{\hyperlink{class_b_tree_aa466823af040ada3f5a56574e337a526}{BTree::s\_CAPACITY}};}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ sibling-\/>entries.insert(}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ \ \ sibling-\/>entries.end(),}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \ \ \ \ std::make\_move\_iterator(midIt),}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \ \ \ \ std::make\_move\_iterator(child-\/>entries.end())}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ child-\/>entries.erase(midIt,\ child-\/>entries.end());}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ sibling-\/>nextLeaf\ =\ child-\/>nextLeaf;}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (child-\/>nextLeaf)\ \{}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ child-\/>nextLeaf-\/>prevLeaf\ =\ sibling;}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ child-\/>nextLeaf\ =\ sibling;}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ sibling-\/>prevLeaf\ =\ child;}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ Key\ promoteKey\ =\ sibling-\/>entries.front().first;}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ parent-\/>keys.insert(parent-\/>keys.begin()\ +\ index,\ promoteKey);}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ parent-\/>children.insert(parent-\/>children.begin()\ +\ index\ +\ 1,\ sibling);}
\DoxyCodeLine{00105\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ mid\ =\ \mbox{\hyperlink{class_b_tree_aa466823af040ada3f5a56574e337a526}{BTree::s\_CAPACITY}}\ -\/\ 1;}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ Key\ medianKey\ =\ std::move(child-\/>keys[mid]);}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ sibling-\/>keys.insert(}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \ \ sibling-\/>keys.end(),}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \ \ \ \ std::make\_move\_iterator(child-\/>keys.begin()\ +\ mid\ +\ 1),}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ std::make\_move\_iterator(child-\/>keys.end())}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ sibling-\/>children.insert(}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ sibling-\/>children.end(),}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ \ \ std::make\_move\_iterator(child-\/>children.begin()\ +\ mid\ +\ 1),}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ std::make\_move\_iterator(child-\/>children.end())}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ child-\/>keys.erase(child-\/>keys.begin()\ +\ mid,\ child-\/>keys.end());}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ child-\/>children.erase(child-\/>children.begin()\ +\ mid\ +\ 1,\ child-\/>children.end());}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ parent-\/>keys.insert(parent-\/>keys.begin()\ +\ index,\ std::move(medianKey));}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ parent-\/>children.insert(parent-\/>children.begin()\ +\ index\ +\ 1,\ sibling);}
\DoxyCodeLine{00126\ \ \ \ \ \}}
\DoxyCodeLine{00127\ \}}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00130\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_b_tree_a760c03d4ce002fdc71a531e2c47b420b}{BTree<Key,\ Value,\ Compare>::insertNonFull}}(\mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}*\ node,\ \textcolor{keyword}{const}\ Key\&\ key,\ \textcolor{keyword}{const}\ Value\&\ value)}
\DoxyCodeLine{00131\ \{}
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{keywordflow}{if}\ (node-\/>isLeaf)\ \{}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ it\ =\ node-\/>entries.begin();}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (it\ !=\ node-\/>entries.end()\ \&\&\ \mbox{\hyperlink{class_b_tree_a2f8fc0b0f01e1839ceddd94b278d05ae}{less}}(it-\/>first,\ key))\ \{}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \ \ \ \ ++it;}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it\ !=\ node-\/>entries.end()\ \&\&\ !\mbox{\hyperlink{class_b_tree_a2f8fc0b0f01e1839ceddd94b278d05ae}{less}}(key,\ it-\/>first)\ \&\&\ !\mbox{\hyperlink{class_b_tree_a2f8fc0b0f01e1839ceddd94b278d05ae}{less}}(it-\/>first,\ key))\ \{}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \ \ \ \ it-\/>second\ =\ value;}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ node-\/>entries.insert(it,\ \{\ key,\ value\ \});}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00148\ \ \ \ \ \}}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ i\ =\ 0;}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ \ \ \ \ \textcolor{keywordflow}{while}\ (i\ <\ node-\/>keys.size()\ \&\&\ \mbox{\hyperlink{class_b_tree_a2f8fc0b0f01e1839ceddd94b278d05ae}{less}}(node-\/>keys[i],\ key))\ \{}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ ++i;}
\DoxyCodeLine{00154\ \ \ \ \ \}}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}*\ child\ =\ node-\/>children[i];}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00158\ \ \ \ \ \textcolor{keywordtype}{bool}\ childFull\ =\ child-\/>isLeaf\ ?\ (child-\/>entries.size()\ >=\ 2\ *\ \mbox{\hyperlink{class_b_tree_aa466823af040ada3f5a56574e337a526}{BTree::s\_CAPACITY}}\ -\/\ 1)\ :\ (child-\/>keys.size()\ >=\ 2\ *\ \mbox{\hyperlink{class_b_tree_aa466823af040ada3f5a56574e337a526}{BTree::s\_CAPACITY}}\ -\/\ 1);}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{keywordflow}{if}\ (childFull)\ \{}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_b_tree_a644946dc5c2b58a1c7ddf8d52fa1b2e8}{splitChild}}(node,\ i);}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{class_b_tree_a2f8fc0b0f01e1839ceddd94b278d05ae}{less}}(node-\/>keys[i],\ key))\ \{}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \ \ \ \ ++i;}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00166\ \ \ \ \ \}}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_b_tree_a760c03d4ce002fdc71a531e2c47b420b}{insertNonFull}}(node-\/>children[i],\ key,\ value);}
\DoxyCodeLine{00169\ \}}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00172\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_b_tree_a1f618d0a26ec20a12ad3b05e06c78970}{BTree<Key,\ Value,\ Compare>::insert}}(\textcolor{keyword}{const}\ Key\&\ key,\ \textcolor{keyword}{const}\ Value\&\ value)}
\DoxyCodeLine{00173\ \{}
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{keywordtype}{bool}\ rootFull\ =\ m\_Root-\/>isLeaf\ ?\ (m\_Root-\/>entries.size()\ >=\ 2\ *\ \mbox{\hyperlink{class_b_tree_aa466823af040ada3f5a56574e337a526}{BTree::s\_CAPACITY}}\ -\/\ 1)\ :\ (m\_Root-\/>keys.size()\ >=\ 2\ *\ \mbox{\hyperlink{class_b_tree_aa466823af040ada3f5a56574e337a526}{BTree::s\_CAPACITY}}\ -\/\ 1);}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \ \ \textcolor{keywordflow}{if}\ (rootFull)\ \{}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}*\ oldRoot\ =\ m\_Root;}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}*\ newRoot\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}(\textcolor{keyword}{false});}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ newRoot-\/>children.push\_back(oldRoot);}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_b_tree_a644946dc5c2b58a1c7ddf8d52fa1b2e8}{splitChild}}(newRoot,\ 0);}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ m\_Root\ =\ newRoot;}
\DoxyCodeLine{00183\ \ \ \ \ \}}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \ \ \textcolor{keywordtype}{bool}\ inserted\ =\ \mbox{\hyperlink{class_b_tree_a760c03d4ce002fdc71a531e2c47b420b}{insertNonFull}}(m\_Root,\ key,\ value);}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{keywordflow}{if}\ (inserted)\ \{}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ ++m\_Size;}
\DoxyCodeLine{00189\ \ \ \ \ \}}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \ \ \ \ \textcolor{keywordflow}{return}\ inserted;}
\DoxyCodeLine{00192\ \}}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00195\ Value*\ \mbox{\hyperlink{class_b_tree_a6ac491a77f862fa00a94cf7a688d7e48}{BTree<Key,\ Value,\ Compare>::search}}(\textcolor{keyword}{const}\ Key\&\ key)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00196\ \textcolor{keyword}{}\{}
\DoxyCodeLine{00197\ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}*\ node\ =\ m\_Root;}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \ \ \ \ \textcolor{keywordflow}{while}\ (!node-\/>isLeaf)\ \{}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ it\ =\ std::lower\_bound(}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \ \ \ \ node-\/>keys.begin(),}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \ \ node-\/>keys.end(),}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ \ \ key,}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ \ \ m\_Comp}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ idx\ =\ std::distance(node-\/>keys.begin(),\ it);}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ node\ =\ node-\/>children[idx];}
\DoxyCodeLine{00209\ \ \ \ \ \}}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ entry\ :\ node-\/>entries)\ \{}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{class_b_tree_a2f8fc0b0f01e1839ceddd94b278d05ae}{less}}(entry.first,\ key)\ \&\&\ !\mbox{\hyperlink{class_b_tree_a2f8fc0b0f01e1839ceddd94b278d05ae}{less}}(key,\ entry.first))\ \{}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \&entry.second;}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{class_b_tree_a2f8fc0b0f01e1839ceddd94b278d05ae}{less}}(key,\ entry.first))\ \{}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \ \ \ \ break\ ;}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00219\ \ \ \ \ \}}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00222\ \}}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00226\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_b_tree_a0a0989a366b92907a8389360532e201b}{BTree<Key,\ Value,\ Compare>::remove}}(\textcolor{keyword}{const}\ Key\&\ key)}
\DoxyCodeLine{00227\ \{}
\DoxyCodeLine{00228\ \ \ \ \ \textcolor{keywordflow}{if}\ (!m\_Root)}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00230\ }
\DoxyCodeLine{00231\ \ \ \ \ \mbox{\hyperlink{class_b_tree_a4faf55ac6eafe3249ecfea528e2b6940}{removeFromNode}}(m\_Root,\ key);}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \ \ \ \ -\/-\/m\_Size;}
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00235\ \ \ \ \ \textcolor{comment}{//\ if\ root\ is\ internal\ and\ now\ empty,\ delete\ it}}
\DoxyCodeLine{00236\ \ \ \ \ \textcolor{keywordflow}{if}\ (!m\_Root-\/>isLeaf\ \&\&\ m\_Root-\/>keys.empty())\ \{}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}\ *old\ =\ m\_Root;}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ m\_Root\ =\ m\_Root-\/>children.front();}
\DoxyCodeLine{00240\ }
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ old;}
\DoxyCodeLine{00242\ \ \ \ \ \}}
\DoxyCodeLine{00243\ }
\DoxyCodeLine{00244\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00245\ \}}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00247\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00248\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{class_b_tree_aa53d01b3c5039553df1f1fbe6afbf337}{BTree<Key,\ Value,\ Compare>::getPredecessor}}(\mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}\ *node,\ \textcolor{keywordtype}{size\_t}\ idx)\ \textcolor{keyword}{const}\ -\/>\ Key}
\DoxyCodeLine{00249\ \{}
\DoxyCodeLine{00250\ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}\ *cur\ =\ node-\/>children[idx];}
\DoxyCodeLine{00251\ }
\DoxyCodeLine{00252\ \ \ \ \ \textcolor{keywordflow}{while}\ (!cur-\/>isLeaf)\ \{}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ cur\ =\ cur-\/>children.back();}
\DoxyCodeLine{00254\ \ \ \ \ \}}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \ \ \ \ \textcolor{keywordflow}{return}\ cur-\/>entries.back().first;}
\DoxyCodeLine{00257\ \}}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00259\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00260\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{class_b_tree_acf3b2d3f85cd319dd01dbffc970614c7}{BTree<Key,\ Value,\ Compare>::getSuccessor}}(\mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}\ *node,\ \textcolor{keywordtype}{size\_t}\ idx)\ \textcolor{keyword}{const}\ -\/>\ Key}
\DoxyCodeLine{00261\ \{}
\DoxyCodeLine{00262\ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}\ *cur\ =\ node-\/>children[idx\ +\ 1];}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \ \ \ \ \textcolor{keywordflow}{while}\ (!cur-\/>isLeaf)\ \{}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ cur\ =\ cur-\/>children.front();}
\DoxyCodeLine{00266\ \ \ \ \ \}}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \ \ \ \ \textcolor{keywordflow}{return}\ cur-\/>entries.front().first;}
\DoxyCodeLine{00269\ \}}
\DoxyCodeLine{00270\ }
\DoxyCodeLine{00271\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00272\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_b_tree_a391b01dbf324db440cc17a77e631a064}{BTree<Key,\ Value,\ Compare>::fill}}(\mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}\ *node,\ \textcolor{keywordtype}{size\_t}\ idx)}
\DoxyCodeLine{00273\ \{}
\DoxyCodeLine{00274\ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}\ *child\ =\ node-\/>children[idx];}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \ \ \textcolor{comment}{//\ try\ borrow\ from\ left\ sibling}}
\DoxyCodeLine{00277\ \ \ \ \ \textcolor{keywordflow}{if}\ (idx\ >\ 0\ \&\&\ ((node-\/>children[idx\ -\/\ 1]-\/>isLeaf}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ ?\ node-\/>children[idx\ -\/\ 1]-\/>entries.size()}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ :\ node-\/>children[idx\ -\/\ 1]-\/>keys.size())\ >=\ \mbox{\hyperlink{class_b_tree_aa466823af040ada3f5a56574e337a526}{BTree::s\_CAPACITY}}))}
\DoxyCodeLine{00280\ \ \ \ \ \{}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_b_tree_a8db0d5ceac0ac47ed3a22ad5ea7b1d94}{borrowFromPrev}}(node,\ idx);}
\DoxyCodeLine{00282\ \ \ \ \ \}}
\DoxyCodeLine{00283\ \ \ \ \ \textcolor{comment}{//\ else\ try\ borrow\ from\ right\ sibling}}
\DoxyCodeLine{00284\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (idx\ <\ node-\/>keys.size()\ \&\&\ ((node-\/>children[idx\ +\ 1]-\/>isLeaf}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ ?\ node-\/>children[idx\ +\ 1]-\/>entries.size()}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ :\ node-\/>children[idx\ +\ 1]-\/>keys.size())\ >=\ \mbox{\hyperlink{class_b_tree_aa466823af040ada3f5a56574e337a526}{BTree::s\_CAPACITY}}))}
\DoxyCodeLine{00287\ \ \ \ \ \{}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_b_tree_aa8547724653e13afd62e9f2ef384ff2a}{borrowFromNext}}(node,\ idx);}
\DoxyCodeLine{00289\ \ \ \ \ \}}
\DoxyCodeLine{00290\ \ \ \ \ \textcolor{comment}{//\ else\ merge\ with\ a\ sibling}}
\DoxyCodeLine{00291\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00292\ \ \ \ \ \{}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (idx\ <\ node-\/>keys.size())}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_b_tree_aac69f678bcb722552d0123503594b08d}{mergeNodes}}(node,\ idx);}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_b_tree_aac69f678bcb722552d0123503594b08d}{mergeNodes}}(node,\ idx\ -\/\ 1);}
\DoxyCodeLine{00297\ \ \ \ \ \}}
\DoxyCodeLine{00298\ \}}
\DoxyCodeLine{00299\ }
\DoxyCodeLine{00300\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00301\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_b_tree_a8db0d5ceac0ac47ed3a22ad5ea7b1d94}{BTree<Key,\ Value,\ Compare>::borrowFromPrev}}(\mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}\ *node,\ \textcolor{keywordtype}{size\_t}\ idx)}
\DoxyCodeLine{00302\ \{}
\DoxyCodeLine{00303\ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}\ *child\ =\ node-\/>children[idx];}
\DoxyCodeLine{00304\ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}\ *left\ =\ node-\/>children[idx\ -\/\ 1];}
\DoxyCodeLine{00305\ }
\DoxyCodeLine{00306\ \ \ \ \ \textcolor{keywordflow}{if}\ (child-\/>isLeaf)}
\DoxyCodeLine{00307\ \ \ \ \ \{}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ steal\ one\ entry\ from\ left\ leaf}}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ child-\/>entries.insert(}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \ \ \ \ child-\/>entries.begin(),}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \ \ \ \ std::move(left-\/>entries.back())}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ left-\/>entries.pop\_back();}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ update\ parent\ key}}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ node-\/>keys[idx\ -\/\ 1]\ =\ child-\/>entries.front().first;}
\DoxyCodeLine{00317\ \ \ \ \ \}}
\DoxyCodeLine{00318\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00319\ \ \ \ \ \{}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ steal\ one\ key+child\ from\ left\ internal}}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ child-\/>keys.insert(child-\/>keys.begin(),\ node-\/>keys[idx\ -\/\ 1]);}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ node-\/>keys[idx\ -\/\ 1]\ =\ left-\/>keys.back();}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ left-\/>keys.pop\_back();}
\DoxyCodeLine{00324\ }
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ child-\/>children.insert(}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \ \ \ \ child-\/>children.begin(),}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ \ \ \ \ left-\/>children.back()}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00329\ }
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ left-\/>children.pop\_back();}
\DoxyCodeLine{00331\ \ \ \ \ \}}
\DoxyCodeLine{00332\ \}}
\DoxyCodeLine{00333\ }
\DoxyCodeLine{00334\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00335\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_b_tree_aa8547724653e13afd62e9f2ef384ff2a}{BTree<Key,\ Value,\ Compare>::borrowFromNext}}(\mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}\ *node,\ \textcolor{keywordtype}{size\_t}\ idx)}
\DoxyCodeLine{00336\ \{}
\DoxyCodeLine{00337\ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}\ *child\ =\ node-\/>children[idx];}
\DoxyCodeLine{00338\ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}\ *right\ =\ node-\/>children[idx\ +\ 1];}
\DoxyCodeLine{00339\ }
\DoxyCodeLine{00340\ \ \ \ \ \textcolor{keywordflow}{if}\ (child-\/>isLeaf)}
\DoxyCodeLine{00341\ \ \ \ \ \{}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ steal\ one\ entry\ from\ right\ leaf}}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ child-\/>entries.push\_back(std::move(right-\/>entries.front()));}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ right-\/>entries.erase(right-\/>entries.begin());}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ update\ parent\ key}}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ node-\/>keys[idx]\ =\ right-\/>entries.front().first;}
\DoxyCodeLine{00347\ \ \ \ \ \}}
\DoxyCodeLine{00348\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00349\ \ \ \ \ \{}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ steal\ one\ key+child\ from\ right\ internal}}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ child-\/>keys.push\_back(node-\/>keys[idx]);}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ node-\/>keys[idx]\ =\ right-\/>keys.front();}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ right-\/>keys.erase(right-\/>keys.begin());}
\DoxyCodeLine{00354\ }
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ child-\/>children.push\_back(right-\/>children.front());}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ right-\/>children.erase(right-\/>children.begin());}
\DoxyCodeLine{00357\ \ \ \ \ \}}
\DoxyCodeLine{00358\ \}}
\DoxyCodeLine{00359\ }
\DoxyCodeLine{00360\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00361\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_b_tree_aac69f678bcb722552d0123503594b08d}{BTree<Key,\ Value,\ Compare>::mergeNodes}}(\mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}\ *node,\ \textcolor{keywordtype}{size\_t}\ idx)}
\DoxyCodeLine{00362\ \{}
\DoxyCodeLine{00363\ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}\ *left\ =\ node-\/>children[idx];}
\DoxyCodeLine{00364\ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}\ *right\ =\ node-\/>children[idx\ +\ 1];}
\DoxyCodeLine{00365\ }
\DoxyCodeLine{00366\ \ \ \ \ \textcolor{keywordflow}{if}\ (left-\/>isLeaf)}
\DoxyCodeLine{00367\ \ \ \ \ \{}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ merge\ leaf\ entries}}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \ \ left-\/>entries.insert(}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ \ \ \ \ left-\/>entries.end(),}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \ \ \ \ \ \ std::make\_move\_iterator(right-\/>entries.begin()),}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \ \ \ \ \ \ std::make\_move\_iterator(right-\/>entries.end())}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00374\ }
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ stitch\ leaf\ list}}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ left-\/>nextLeaf\ =\ right-\/>nextLeaf;}
\DoxyCodeLine{00377\ }
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (right-\/>nextLeaf)}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ \ \ \ \ right-\/>nextLeaf-\/>prevLeaf\ =\ left;}
\DoxyCodeLine{00380\ \ \ \ \ \}}
\DoxyCodeLine{00381\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00382\ \ \ \ \ \{}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ pull\ down\ the\ separating\ key}}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ left-\/>keys.push\_back(node-\/>keys[idx]);}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ append\ right’s\ keys\ and\ children}}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ left-\/>keys.insert(}
\DoxyCodeLine{00387\ \ \ \ \ \ \ \ \ \ \ \ \ left-\/>keys.end(),}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ \ \ \ \ right-\/>keys.begin(),}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ \ \ \ \ right-\/>keys.end()}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00391\ }
\DoxyCodeLine{00392\ \ \ \ \ \ \ \ \ left-\/>children.insert(}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ \ \ \ \ left-\/>children.end(),}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \ \ \ \ \ \ right-\/>children.begin(),}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \ \ \ \ right-\/>children.end()}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00397\ \ \ \ \ \}}
\DoxyCodeLine{00398\ }
\DoxyCodeLine{00399\ \ \ \ \ \textcolor{comment}{//\ remove\ right\ sibling}}
\DoxyCodeLine{00400\ \ \ \ \ node-\/>children.erase(node-\/>children.begin()\ +\ idx\ +\ 1);}
\DoxyCodeLine{00401\ \ \ \ \ node-\/>keys.erase(node-\/>keys.begin()\ +\ idx);}
\DoxyCodeLine{00402\ }
\DoxyCodeLine{00403\ \ \ \ \ \textcolor{keyword}{delete}\ right;}
\DoxyCodeLine{00404\ \}}
\DoxyCodeLine{00405\ }
\DoxyCodeLine{00406\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00407\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_b_tree_a4faf55ac6eafe3249ecfea528e2b6940}{BTree<Key,\ Value,\ Compare>::removeFromNode}}(\mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}\ *node,\ \textcolor{keyword}{const}\ Key\ \&key)}
\DoxyCodeLine{00408\ \{}
\DoxyCodeLine{00409\ \ \ \ \ \textcolor{comment}{//\ 1)\ Find\ the\ first\ index\ ≥\ key}}
\DoxyCodeLine{00410\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ idx\ =\ 0;}
\DoxyCodeLine{00411\ \ \ \ \ \textcolor{keywordflow}{while}\ (idx\ <\ node-\/>keys.size()\ \&\&\ \mbox{\hyperlink{class_b_tree_a2f8fc0b0f01e1839ceddd94b278d05ae}{less}}(node-\/>keys[idx],\ key))}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ ++idx;}
\DoxyCodeLine{00413\ }
\DoxyCodeLine{00414\ \ \ \ \ \textcolor{comment}{//\ 2)\ Case\ A:\ key\ is\ in\ this\ node\ (and\ node\ is\ leaf\ or\ internal)}}
\DoxyCodeLine{00415\ \ \ \ \ \textcolor{keywordflow}{if}\ (idx\ <\ node-\/>keys.size()\ \&\&\ !\mbox{\hyperlink{class_b_tree_a2f8fc0b0f01e1839ceddd94b278d05ae}{less}}(key,\ node-\/>keys[idx])\ \&\&\ !\mbox{\hyperlink{class_b_tree_a2f8fc0b0f01e1839ceddd94b278d05ae}{less}}(node-\/>keys[idx],\ key))}
\DoxyCodeLine{00416\ \ \ \ \ \{}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (node-\/>isLeaf)}
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ A1)\ Leaf:\ erase\ the\ entry}}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ eit\ =\ std::find\_if(}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ node-\/>entries.begin(),}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ node-\/>entries.end(),}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [\&](\textcolor{keyword}{auto}\ \textcolor{keyword}{const}\ \&p)}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ return\ !less(p.first,\ key)\ \&\&\ !less(key,\ p.first);\ \});}
\DoxyCodeLine{00425\ }
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (eit\ !=\ node-\/>entries.end())}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ node-\/>entries.erase(eit);}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00433\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ A2)\ Internal:\ three\ subcases}}
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}\ *leftChild\ =\ node-\/>children[idx];}
\DoxyCodeLine{00435\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}\ *rightChild\ =\ node-\/>children[idx\ +\ 1];}
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ leftCount\ =\ leftChild-\/>isLeaf\ ?\ leftChild-\/>entries.size()}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ leftChild-\/>keys.size();}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ rightCount\ =\ rightChild-\/>isLeaf\ ?\ rightChild-\/>entries.size()}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ rightChild-\/>keys.size();}
\DoxyCodeLine{00440\ }
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (leftCount\ >=\ \mbox{\hyperlink{class_b_tree_aa466823af040ada3f5a56574e337a526}{BTree::s\_CAPACITY}})}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00443\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Key\ pred\ =\ \mbox{\hyperlink{class_b_tree_aa53d01b3c5039553df1f1fbe6afbf337}{getPredecessor}}(node,\ idx);}
\DoxyCodeLine{00444\ }
\DoxyCodeLine{00445\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ node-\/>keys[idx]\ =\ pred;}
\DoxyCodeLine{00446\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_b_tree_a4faf55ac6eafe3249ecfea528e2b6940}{removeFromNode}}(leftChild,\ pred);}
\DoxyCodeLine{00447\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00448\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (rightCount\ >=\ \mbox{\hyperlink{class_b_tree_aa466823af040ada3f5a56574e337a526}{BTree::s\_CAPACITY}})}
\DoxyCodeLine{00449\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00450\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Key\ succ\ =\ \mbox{\hyperlink{class_b_tree_acf3b2d3f85cd319dd01dbffc970614c7}{getSuccessor}}(node,\ idx);}
\DoxyCodeLine{00451\ }
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ node-\/>keys[idx]\ =\ succ;}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_b_tree_a4faf55ac6eafe3249ecfea528e2b6940}{removeFromNode}}(rightChild,\ succ);}
\DoxyCodeLine{00454\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00455\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00457\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ both\ children\ have\ only\ CAPACITY-\/1\ keys\ →\ merge}}
\DoxyCodeLine{00458\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_b_tree_aac69f678bcb722552d0123503594b08d}{mergeNodes}}(node,\ idx);}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_b_tree_a4faf55ac6eafe3249ecfea528e2b6940}{removeFromNode}}(leftChild,\ key);}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00461\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00462\ \ \ \ \ \}}
\DoxyCodeLine{00463\ \ \ \ \ \textcolor{comment}{//\ 3)\ Case\ B:\ key\ not\ in\ this\ node}}
\DoxyCodeLine{00464\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00465\ \ \ \ \ \{}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (node-\/>isLeaf)}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00470\ }
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ lastChild\ =\ (idx\ ==\ node-\/>keys.size());}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}\ *child\ =\ node-\/>children[idx];}
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ childCount\ =\ child-\/>isLeaf\ ?\ child-\/>entries.size()}
\DoxyCodeLine{00474\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ child-\/>keys.size();}
\DoxyCodeLine{00475\ }
\DoxyCodeLine{00476\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ensure\ child\ has\ at\ least\ CAPACITY\ keys}}
\DoxyCodeLine{00477\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (childCount\ <\ \mbox{\hyperlink{class_b_tree_aa466823af040ada3f5a56574e337a526}{BTree::s\_CAPACITY}})}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_b_tree_a391b01dbf324db440cc17a77e631a064}{fill}}(node,\ idx);}
\DoxyCodeLine{00480\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00481\ }
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ after\ fill(),\ decide\ correct\ subtree}}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (lastChild\ \&\&\ idx\ >\ node-\/>keys.size())}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_b_tree_a4faf55ac6eafe3249ecfea528e2b6940}{removeFromNode}}(node-\/>children[idx\ -\/\ 1],\ key);}
\DoxyCodeLine{00485\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00486\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_b_tree_a4faf55ac6eafe3249ecfea528e2b6940}{removeFromNode}}(node-\/>children[idx],\ key);}
\DoxyCodeLine{00487\ \ \ \ \ \}}
\DoxyCodeLine{00488\ \}}
\DoxyCodeLine{00489\ }
\DoxyCodeLine{00490\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00491\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_b_tree_a6a530f1aca4a6ab8d2009ea5e3dde846}{BTree<Key,\ Value,\ Compare>::rebalanceLeaf}}(\mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}*\ leaf,\ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}*\ parent,\ \textcolor{keywordtype}{size\_t}\ index)\ \{}
\DoxyCodeLine{00492\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ minEntries\ =\ \mbox{\hyperlink{class_b_tree_aa466823af040ada3f5a56574e337a526}{BTree::s\_CAPACITY}}\ -\/\ 1;}
\DoxyCodeLine{00493\ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}*\ left\ =\ index\ >\ 0\ ?\ parent-\/>children[index\ -\/\ 1]\ :\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00494\ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}*\ right\ =\ index\ +\ 1\ <\ parent-\/>children.size()\ ?\ parent-\/>children[index\ +\ 1]\ :\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00495\ }
\DoxyCodeLine{00496\ \ \ \ \ \textcolor{keywordflow}{if}\ (left\ \&\&\ left-\/>entries.size()\ >\ minEntries)\ \{}
\DoxyCodeLine{00497\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ kv\ =\ left-\/>entries.back();}
\DoxyCodeLine{00498\ }
\DoxyCodeLine{00499\ \ \ \ \ \ \ \ \ left-\/>entries.pop\_back();}
\DoxyCodeLine{00500\ \ \ \ \ \ \ \ \ leaf-\/>entries.insert(leaf-\/>entries.begin(),\ std::move(kv));}
\DoxyCodeLine{00501\ \ \ \ \ \ \ \ \ parent-\/>keys[index\ -\/\ 1]\ =\ leaf-\/>entries.front().first;}
\DoxyCodeLine{00502\ }
\DoxyCodeLine{00503\ \ \ \ \ \ \ \ \ return\ ;}
\DoxyCodeLine{00504\ \ \ \ \ \}}
\DoxyCodeLine{00505\ }
\DoxyCodeLine{00506\ \ \ \ \ \textcolor{keywordflow}{if}\ (right\ \&\&\ right-\/>entries.size()\ >\ minEntries)\ \{}
\DoxyCodeLine{00507\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ kv\ =\ right-\/>entries.front();}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ right-\/>entries.pop\_front();}}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \ \ right-\/>entries.erase(right-\/>entries.begin());}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \ \ leaf-\/>entries.push\_back(kv);}
\DoxyCodeLine{00511\ \ \ \ \ \ \ \ \ parent-\/>keys[index]\ =\ right-\/>entries.front().first;}
\DoxyCodeLine{00512\ }
\DoxyCodeLine{00513\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00514\ \ \ \ \ \}}
\DoxyCodeLine{00515\ }
\DoxyCodeLine{00516\ \ \ \ \ \textcolor{keywordflow}{if}\ (left)\ \{}
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ left-\/>entries.insert(}
\DoxyCodeLine{00518\ \ \ \ \ \ \ \ \ \ \ \ \ left-\/>entries.end(),}
\DoxyCodeLine{00519\ \ \ \ \ \ \ \ \ \ \ \ \ std::make\_move\_iterator(leaf-\/>entries.begin()),}
\DoxyCodeLine{00520\ \ \ \ \ \ \ \ \ \ \ \ \ std::make\_move\_iterator(leaf-\/>entries.end())}
\DoxyCodeLine{00521\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00522\ }
\DoxyCodeLine{00523\ \ \ \ \ \ \ \ \ leaf-\/>entries.clear();}
\DoxyCodeLine{00524\ }
\DoxyCodeLine{00525\ \ \ \ \ \ \ \ \ left-\/>nextLeaf\ =\ leaf-\/>nextLeaf;}
\DoxyCodeLine{00526\ }
\DoxyCodeLine{00527\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (leaf-\/>nextLeaf)\ \{}
\DoxyCodeLine{00528\ \ \ \ \ \ \ \ \ \ \ \ \ leaf-\/>nextLeaf-\/>prevLeaf\ =\ left;}
\DoxyCodeLine{00529\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00530\ }
\DoxyCodeLine{00531\ \ \ \ \ \ \ \ \ parent-\/>children.erase(parent-\/>children.begin()\ +\ index);}
\DoxyCodeLine{00532\ \ \ \ \ \ \ \ \ parent-\/>keys.erase(parent-\/>keys.begin()\ +\ index\ -\/\ 1);}
\DoxyCodeLine{00533\ }
\DoxyCodeLine{00534\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ leaf;}
\DoxyCodeLine{00535\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00536\ \ \ \ \ \ \ \ \ leaf-\/>entries.insert(}
\DoxyCodeLine{00537\ \ \ \ \ \ \ \ \ \ \ \ \ leaf-\/>entries.end(),}
\DoxyCodeLine{00538\ \ \ \ \ \ \ \ \ \ \ \ \ std::make\_move\_iterator(right-\/>entries.begin()),}
\DoxyCodeLine{00539\ \ \ \ \ \ \ \ \ \ \ \ \ std::make\_move\_iterator(right-\/>entries.end())}
\DoxyCodeLine{00540\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00541\ }
\DoxyCodeLine{00542\ \ \ \ \ \ \ \ \ right-\/>entries.clear();}
\DoxyCodeLine{00543\ }
\DoxyCodeLine{00544\ \ \ \ \ \ \ \ \ leaf-\/>nextLeaf\ =\ right-\/>nextLeaf;}
\DoxyCodeLine{00545\ }
\DoxyCodeLine{00546\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (right-\/>nextLeaf)\ \{}
\DoxyCodeLine{00547\ \ \ \ \ \ \ \ \ \ \ \ \ right-\/>nextLeaf-\/>prevLeaf\ =\ leaf;}
\DoxyCodeLine{00548\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00549\ }
\DoxyCodeLine{00550\ \ \ \ \ \ \ \ \ parent-\/>children.erase(parent-\/>children.begin()\ +\ index\ +\ 1);}
\DoxyCodeLine{00551\ \ \ \ \ \ \ \ \ parent-\/>keys.erase(parent-\/>keys.begin()\ +\ index);}
\DoxyCodeLine{00552\ }
\DoxyCodeLine{00553\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ right;}
\DoxyCodeLine{00554\ \ \ \ \ \}}
\DoxyCodeLine{00555\ \}}
\DoxyCodeLine{00556\ }
\DoxyCodeLine{00557\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00558\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_b_tree_af95c5741c674dc4532336c0adab4ea3a}{BTree<Key,\ Value,\ Compare>::rebalanceInternal}}(\mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}*\ node,\ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}*\ parent,\ \textcolor{keywordtype}{size\_t}\ index)\ \{}
\DoxyCodeLine{00559\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ minKeys\ =\ \mbox{\hyperlink{class_b_tree_aa466823af040ada3f5a56574e337a526}{BTree::s\_CAPACITY}}\ -\/\ 1;}
\DoxyCodeLine{00560\ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}*\ left\ =\ index\ >\ 0\ ?\ parent-\/>children[index\ -\/\ 1]\ :\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00561\ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}*\ right\ =\ index\ +\ 1\ <\ parent-\/>children.size()\ ?\ parent-\/>children[index\ +\ 1]\ :\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00562\ }
\DoxyCodeLine{00563\ \ \ \ \ \textcolor{keywordflow}{if}\ (left\ \&\&\ left-\/>keys.size()\ >\ minKeys)\ \{}
\DoxyCodeLine{00564\ \ \ \ \ \ \ \ \ Key\ sep\ =\ parent-\/>keys[index\ -\/\ 1];}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}*\ c\ =\ left-\/>children.back();}
\DoxyCodeLine{00566\ }
\DoxyCodeLine{00567\ \ \ \ \ \ \ \ \ left-\/>children.pop\_back();}
\DoxyCodeLine{00568\ }
\DoxyCodeLine{00569\ \ \ \ \ \ \ \ \ Key\ k2\ =\ left-\/>keys.back();}
\DoxyCodeLine{00570\ }
\DoxyCodeLine{00571\ \ \ \ \ \ \ \ \ left-\/>keys.pop\_back();}
\DoxyCodeLine{00572\ }
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ node-\/>children.insert(node-\/>children.begin(),\ c);}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \ \ node-\/>keys.insert(node-\/>keys.begin(),\ sep);}
\DoxyCodeLine{00575\ }
\DoxyCodeLine{00576\ \ \ \ \ \ \ \ \ parent-\/>keys[index\ -\/\ 1]\ =\ k2;}
\DoxyCodeLine{00577\ }
\DoxyCodeLine{00578\ \ \ \ \ \ \ \ \ return\ ;}
\DoxyCodeLine{00579\ \ \ \ \ \}}
\DoxyCodeLine{00580\ }
\DoxyCodeLine{00581\ \ \ \ \ \textcolor{keywordflow}{if}\ (right\ \&\&\ right-\/>keys.size()\ >\ minKeys)\ \{}
\DoxyCodeLine{00582\ \ \ \ \ \ \ \ \ Key\ sep\ =\ parent-\/>keys[index];}
\DoxyCodeLine{00583\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}*\ c\ =\ right-\/>children.front();}
\DoxyCodeLine{00584\ }
\DoxyCodeLine{00585\ \ \ \ \ \ \ \ \ right-\/>children.erase(right-\/>children.begin());}
\DoxyCodeLine{00586\ }
\DoxyCodeLine{00587\ \ \ \ \ \ \ \ \ Key\ k2\ =\ right-\/>keys.front();}
\DoxyCodeLine{00588\ }
\DoxyCodeLine{00589\ \ \ \ \ \ \ \ \ right-\/>keys.erase(right-\/>keys.begin());}
\DoxyCodeLine{00590\ }
\DoxyCodeLine{00591\ \ \ \ \ \ \ \ \ node-\/>children.push\_back(c);}
\DoxyCodeLine{00592\ \ \ \ \ \ \ \ \ node-\/>keys.push\_back(sep);}
\DoxyCodeLine{00593\ \ \ \ \ \ \ \ \ parent-\/>keys[index]\ =\ k2;}
\DoxyCodeLine{00594\ }
\DoxyCodeLine{00595\ \ \ \ \ \ \ \ \ return\ ;}
\DoxyCodeLine{00596\ \ \ \ \ \}}
\DoxyCodeLine{00597\ }
\DoxyCodeLine{00598\ \ \ \ \ \textcolor{keywordflow}{if}\ (left)\ \{}
\DoxyCodeLine{00599\ \ \ \ \ \ \ \ \ Key\ sep\ =\ parent-\/>keys[index\ -\/\ 1];}
\DoxyCodeLine{00600\ }
\DoxyCodeLine{00601\ \ \ \ \ \ \ \ \ left-\/>keys.push\_back(sep);}
\DoxyCodeLine{00602\ \ \ \ \ \ \ \ \ left-\/>keys.insert(left-\/>keys.end(),\ node-\/>keys.begin(),\ node-\/>keys.end());}
\DoxyCodeLine{00603\ \ \ \ \ \ \ \ \ left-\/>children.insert(left-\/>children.end(),\ node-\/>children.begin(),\ node-\/>children.end());}
\DoxyCodeLine{00604\ }
\DoxyCodeLine{00605\ \ \ \ \ \ \ \ \ parent-\/>children.erase(parent-\/>children.begin()\ +\ index);}
\DoxyCodeLine{00606\ \ \ \ \ \ \ \ \ parent-\/>keys.erase(parent-\/>keys.begin()\ +\ index\ -\/\ 1);}
\DoxyCodeLine{00607\ }
\DoxyCodeLine{00608\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ node;}
\DoxyCodeLine{00609\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00610\ \ \ \ \ \ \ \ \ Key\ sep\ =\ parent-\/>keys[index];}
\DoxyCodeLine{00611\ }
\DoxyCodeLine{00612\ \ \ \ \ \ \ \ \ node-\/>keys.push\_back(sep);}
\DoxyCodeLine{00613\ \ \ \ \ \ \ \ \ node-\/>keys.insert(node-\/>keys.end(),\ right-\/>keys.begin(),\ right-\/>keys.end());}
\DoxyCodeLine{00614\ \ \ \ \ \ \ \ \ node-\/>children.insert(node-\/>children.end(),\ right-\/>children.begin(),\ right-\/>children.end());}
\DoxyCodeLine{00615\ }
\DoxyCodeLine{00616\ \ \ \ \ \ \ \ \ parent-\/>children.erase(parent-\/>children.begin()\ +\ index\ +\ 1);}
\DoxyCodeLine{00617\ \ \ \ \ \ \ \ \ parent-\/>keys.erase(parent-\/>keys.begin()\ +\ index);}
\DoxyCodeLine{00618\ }
\DoxyCodeLine{00619\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ right;}
\DoxyCodeLine{00620\ \ \ \ \ \}}
\DoxyCodeLine{00621\ \}}
\DoxyCodeLine{00622\ }
\DoxyCodeLine{00623\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00624\ std::vector<std::pair<const\ Key\ *,\ Value\ *>>\ \mbox{\hyperlink{class_b_tree_a7dd69dade4718a185d457a71d855b517}{BTree<Key,\ Value,\ Compare>::range}}(\textcolor{keyword}{const}\ Key\ \&low,\ \textcolor{keyword}{const}\ Key\ \&high)}
\DoxyCodeLine{00625\ \{}
\DoxyCodeLine{00626\ \ \ \ \ std::vector<std::pair<const\ Key\ *,\ Value\ *>>\ out;}
\DoxyCodeLine{00627\ }
\DoxyCodeLine{00628\ \ \ \ \ \textcolor{keywordflow}{if}\ (!m\_Root)}
\DoxyCodeLine{00629\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ out;}
\DoxyCodeLine{00630\ }
\DoxyCodeLine{00631\ \ \ \ \ \textcolor{comment}{//\ 1)\ Search\ down\ to\ the\ leaf\ that\ could\ contain\ \`{}low`}}
\DoxyCodeLine{00632\ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}\ *n\ =\ m\_Root;}
\DoxyCodeLine{00633\ }
\DoxyCodeLine{00634\ \ \ \ \ \textcolor{keywordflow}{while}\ (!n-\/>isLeaf)\ \{}
\DoxyCodeLine{00635\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ it\ =\ std::upper\_bound(}
\DoxyCodeLine{00636\ \ \ \ \ \ \ \ \ \ \ \ \ n-\/>keys.begin(),\ n-\/>keys.end(),\ low,}
\DoxyCodeLine{00637\ \ \ \ \ \ \ \ \ \ \ \ \ [\textcolor{keyword}{this}](\textcolor{keyword}{auto}\ \textcolor{keyword}{const}\ \&a,\ \textcolor{keyword}{auto}\ \textcolor{keyword}{const}\ \&b)\ \{\ return\ m\_Comp(a,\ b);\ \}}
\DoxyCodeLine{00638\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00639\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ childIdx\ =\ std::distance(n-\/>keys.begin(),\ it);}
\DoxyCodeLine{00640\ }
\DoxyCodeLine{00641\ \ \ \ \ \ \ \ \ n\ =\ n-\/>children[childIdx];}
\DoxyCodeLine{00642\ \ \ \ \ \}}
\DoxyCodeLine{00643\ }
\DoxyCodeLine{00644\ \ \ \ \ \textcolor{comment}{//\ 2)\ In\ that\ leaf,\ find\ the\ first\ entry\ >=\ low}}
\DoxyCodeLine{00645\ \ \ \ \ \textcolor{keyword}{auto}\ entryIt\ =\ std::lower\_bound(}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \ \ n-\/>entries.begin(),\ n-\/>entries.end(),\ low,}
\DoxyCodeLine{00647\ \ \ \ \ \ \ \ \ [\textcolor{keyword}{this}](std::pair<Key,\ Value>\ \textcolor{keyword}{const}\ \&entry,\ \textcolor{keyword}{auto}\ \textcolor{keyword}{const}\ \&val)}
\DoxyCodeLine{00648\ \ \ \ \ \ \ \ \ \{\ return\ m\_Comp(entry.first,\ val);\ \});}
\DoxyCodeLine{00649\ }
\DoxyCodeLine{00650\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ idx\ =\ std::distance(n-\/>entries.begin(),\ entryIt);}
\DoxyCodeLine{00651\ }
\DoxyCodeLine{00652\ \ \ \ \ \textcolor{comment}{//\ 3)\ Collect\ until\ >\ high,\ hopping\ leaves\ as\ needed}}
\DoxyCodeLine{00653\ \ \ \ \ \textcolor{keywordflow}{while}\ (n)\ \{}
\DoxyCodeLine{00654\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (idx\ <\ n-\/>entries.size())\ \{}
\DoxyCodeLine{00655\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \&kv\ =\ n-\/>entries[idx];}
\DoxyCodeLine{00656\ }
\DoxyCodeLine{00657\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (m\_Comp(high,\ kv.first))\ \textcolor{comment}{//\ kv.first\ >\ high\ ?}}
\DoxyCodeLine{00658\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ out;}
\DoxyCodeLine{00659\ }
\DoxyCodeLine{00660\ \ \ \ \ \ \ \ \ \ \ \ \ out.emplace\_back(\&kv.first,\ \&kv.second);}
\DoxyCodeLine{00661\ \ \ \ \ \ \ \ \ \ \ \ \ ++idx;}
\DoxyCodeLine{00662\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00663\ }
\DoxyCodeLine{00664\ \ \ \ \ \ \ \ \ n\ =\ n-\/>nextLeaf;}
\DoxyCodeLine{00665\ \ \ \ \ \ \ \ \ idx\ =\ 0;}
\DoxyCodeLine{00666\ \ \ \ \ \}}
\DoxyCodeLine{00667\ }
\DoxyCodeLine{00668\ \ \ \ \ \textcolor{keywordflow}{return}\ out;}
\DoxyCodeLine{00669\ \}}
\DoxyCodeLine{00670\ }
\DoxyCodeLine{00671\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00672\ std::vector<std::pair<const\ Key\ *,\ Value\ *>>\ \mbox{\hyperlink{class_b_tree_a7dd69dade4718a185d457a71d855b517}{BTree<Key,\ Value,\ Compare>::range}}(\textcolor{keyword}{const}\ Key\ \&low,\ \textcolor{keywordtype}{size\_t}\ count)}
\DoxyCodeLine{00673\ \{}
\DoxyCodeLine{00674\ \ \ \ \ std::vector<std::pair<const\ Key\ *,\ Value\ *>>\ out;}
\DoxyCodeLine{00675\ }
\DoxyCodeLine{00676\ \ \ \ \ \textcolor{keywordflow}{if}\ (!m\_Root\ ||\ count\ ==\ 0)}
\DoxyCodeLine{00677\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ out;}
\DoxyCodeLine{00678\ }
\DoxyCodeLine{00679\ \ \ \ \ \textcolor{comment}{//\ 1)\ Descend\ to\ leaf}}
\DoxyCodeLine{00680\ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}\ *n\ =\ m\_Root;}
\DoxyCodeLine{00681\ }
\DoxyCodeLine{00682\ \ \ \ \ \textcolor{keywordflow}{while}\ (!n-\/>isLeaf)\ \{}
\DoxyCodeLine{00683\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ it\ =\ std::upper\_bound(}
\DoxyCodeLine{00684\ \ \ \ \ \ \ \ \ \ \ \ \ n-\/>keys.begin(),\ n-\/>keys.end(),\ low,}
\DoxyCodeLine{00685\ \ \ \ \ \ \ \ \ \ \ \ \ [\textcolor{keyword}{this}](\textcolor{keyword}{auto}\ \textcolor{keyword}{const}\ \&a,\ \textcolor{keyword}{auto}\ \textcolor{keyword}{const}\ \&b)\ \{\ return\ m\_Comp(a,\ b);\ \}}
\DoxyCodeLine{00686\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00687\ }
\DoxyCodeLine{00688\ \ \ \ \ \ \ \ \ n\ =\ n-\/>children[std::distance(n-\/>keys.begin(),\ it)];}
\DoxyCodeLine{00689\ \ \ \ \ \}}
\DoxyCodeLine{00690\ }
\DoxyCodeLine{00691\ \ \ \ \ \textcolor{comment}{//\ 2)\ Find\ first\ >=\ low}}
\DoxyCodeLine{00692\ \ \ \ \ \textcolor{keyword}{auto}\ entryIt\ =\ std::lower\_bound(}
\DoxyCodeLine{00693\ \ \ \ \ \ \ \ \ n-\/>entries.begin(),\ n-\/>entries.end(),\ low,}
\DoxyCodeLine{00694\ \ \ \ \ \ \ \ \ [\textcolor{keyword}{this}](\textcolor{keyword}{auto}\ \textcolor{keyword}{const}\ \&entry,\ \textcolor{keyword}{auto}\ \textcolor{keyword}{const}\ \&val)\ \{\ return\ m\_Comp(entry.first,\ val);\ \}}
\DoxyCodeLine{00695\ \ \ \ \ );}
\DoxyCodeLine{00696\ }
\DoxyCodeLine{00697\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ idx\ =\ std::distance(n-\/>entries.begin(),\ entryIt);}
\DoxyCodeLine{00698\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ taken\ =\ 0;}
\DoxyCodeLine{00699\ }
\DoxyCodeLine{00700\ \ \ \ \ \textcolor{comment}{//\ 3)\ Collect\ up\ to\ count}}
\DoxyCodeLine{00701\ \ \ \ \ \textcolor{keywordflow}{while}\ (n\ \&\&\ taken\ <\ count)\ \{}
\DoxyCodeLine{00702\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (idx\ <\ n-\/>entries.size())\ \{}
\DoxyCodeLine{00703\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \&kv\ =\ n-\/>entries[idx++];}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \ \ \ \ \ \ out.push\_back(\{\&kv.first,\ \&kv.second\});}
\DoxyCodeLine{00705\ }
\DoxyCodeLine{00706\ \ \ \ \ \ \ \ \ \ \ \ \ ++taken;}
\DoxyCodeLine{00707\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00708\ \ \ \ \ \ \ \ \ \ \ \ \ n\ =\ n-\/>nextLeaf;}
\DoxyCodeLine{00709\ \ \ \ \ \ \ \ \ \ \ \ \ idx\ =\ 0;}
\DoxyCodeLine{00710\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00711\ \ \ \ \ \}}
\DoxyCodeLine{00712\ }
\DoxyCodeLine{00713\ \ \ \ \ \textcolor{keywordflow}{return}\ out;}
\DoxyCodeLine{00714\ \}}
\DoxyCodeLine{00715\ }
\DoxyCodeLine{00716\ \textcolor{preprocessor}{\#ifdef\ BTREE\_ENABLE\_JSON}}
\DoxyCodeLine{00717\ }
\DoxyCodeLine{00718\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00719\ std::string\ BTree<Key,\ Value,\ Compare>::serializeToJson()\textcolor{keyword}{\ const}}
\DoxyCodeLine{00720\ \textcolor{keyword}{}\{}
\DoxyCodeLine{00721\ \ \ \ \ \textcolor{keyword}{using\ }json\ =\ nlohmann::ordered\_json;}
\DoxyCodeLine{00722\ }
\DoxyCodeLine{00723\ \ \ \ \ \textcolor{keyword}{auto}\ ptrToHex\ =\ [](\textcolor{keyword}{auto}\ *ptr)}
\DoxyCodeLine{00724\ \ \ \ \ \{}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \ \ std::ostringstream\ ss;}
\DoxyCodeLine{00726\ \ \ \ \ \ \ \ \ ss\ <<\ \textcolor{stringliteral}{"{}0x"{}}}
\DoxyCodeLine{00727\ \ \ \ \ \ \ \ \ \ \ \ <<\ std::hex\ <<\ std::uppercase}
\DoxyCodeLine{00728\ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{keyword}{reinterpret\_cast<}uintptr\_t\textcolor{keyword}{>}(ptr);}
\DoxyCodeLine{00729\ }
\DoxyCodeLine{00730\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ss.str();}
\DoxyCodeLine{00731\ \ \ \ \ \};}
\DoxyCodeLine{00732\ }
\DoxyCodeLine{00733\ \ \ \ \ \textcolor{comment}{//\ Helper\ to\ turn\ a\ Node*\ into\ a\ JSON\ object}}
\DoxyCodeLine{00734\ \ \ \ \ std::function<json(Node\ *)>\ dumpNode\ =\ [\&](Node\ *node)\ -\/>\ json}
\DoxyCodeLine{00735\ \ \ \ \ \{}
\DoxyCodeLine{00736\ \ \ \ \ \ \ \ \ json\ j;}
\DoxyCodeLine{00737\ }
\DoxyCodeLine{00738\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ id\ as\ hex\ pointer}}
\DoxyCodeLine{00739\ \ \ \ \ \ \ \ \ j[\textcolor{stringliteral}{"{}id"{}}]\ =\ ptrToHex(node);}
\DoxyCodeLine{00740\ }
\DoxyCodeLine{00741\ \ \ \ \ \ \ \ \ j[\textcolor{stringliteral}{"{}isLeaf"{}}]\ =\ node-\/>isLeaf;}
\DoxyCodeLine{00742\ }
\DoxyCodeLine{00743\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ entries:\ [\ [key,value],\ [key,value],\ …\ ]}}
\DoxyCodeLine{00744\ \ \ \ \ \ \ \ \ j[\textcolor{stringliteral}{"{}entries"{}}]\ =\ json::array();}
\DoxyCodeLine{00745\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ \textcolor{keyword}{const}\ \&[k,\ v]\ :\ node-\/>entries)}
\DoxyCodeLine{00746\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00747\ \ \ \ \ \ \ \ \ \ \ \ \ j[\textcolor{stringliteral}{"{}entries"{}}].push\_back(json::array(\{k,\ v\}));}
\DoxyCodeLine{00748\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00749\ }
\DoxyCodeLine{00750\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ children:\ recurse\ or\ empty\ array\ for\ leaves}}
\DoxyCodeLine{00751\ \ \ \ \ \ \ \ \ j[\textcolor{stringliteral}{"{}children"{}}]\ =\ json::array();}
\DoxyCodeLine{00752\ }
\DoxyCodeLine{00753\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!node-\/>isLeaf)}
\DoxyCodeLine{00754\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00755\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (Node\ *child\ :\ node-\/>children)}
\DoxyCodeLine{00756\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00757\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ j[\textcolor{stringliteral}{"{}children"{}}].push\_back(dumpNode(child));}
\DoxyCodeLine{00758\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00759\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00760\ \ \ \ \ \ \ \ \ \ \ \ \ json\ prev\ =\ node-\/>prevLeaf\ ?\ json(ptrToHex(node-\/>prevLeaf))\ :\ json(nullptr);}
\DoxyCodeLine{00761\ \ \ \ \ \ \ \ \ \ \ \ \ json\ next\ =\ node-\/>nextLeaf\ ?\ json(ptrToHex(node-\/>nextLeaf))\ :\ json(nullptr);}
\DoxyCodeLine{00762\ }
\DoxyCodeLine{00763\ \ \ \ \ \ \ \ \ \ \ \ \ j[\textcolor{stringliteral}{"{}prev"{}}]\ =\ std::move(prev);}
\DoxyCodeLine{00764\ \ \ \ \ \ \ \ \ \ \ \ \ j[\textcolor{stringliteral}{"{}next"{}}]\ =\ std::move(next);}
\DoxyCodeLine{00765\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00766\ }
\DoxyCodeLine{00767\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ j;}
\DoxyCodeLine{00768\ \ \ \ \ \};}
\DoxyCodeLine{00769\ }
\DoxyCodeLine{00770\ \ \ \ \ \textcolor{comment}{//\ top‐level\ wrapper}}
\DoxyCodeLine{00771\ \ \ \ \ json\ out;}
\DoxyCodeLine{00772\ \ \ \ \ out[\textcolor{stringliteral}{"{}node"{}}]\ =\ dumpNode(m\_Root);}
\DoxyCodeLine{00773\ }
\DoxyCodeLine{00774\ \ \ \ \ \textcolor{keywordflow}{return}\ out.dump(2);\ \textcolor{comment}{//\ 2-\/space\ indent}}
\DoxyCodeLine{00775\ \}}
\DoxyCodeLine{00776\ }
\DoxyCodeLine{00777\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00778\ }
\DoxyCodeLine{00779\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00780\ \textcolor{keyword}{class\ }BTree<Key,\ Value,\ Compare>::Iterator\ \{}
\DoxyCodeLine{00781\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00782\ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }difference\_type\ =\ std::ptrdiff\_t;}
\DoxyCodeLine{00783\ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }value\_type\ =\ std::pair<const\ Key\&,\ Value\&>;}
\DoxyCodeLine{00784\ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }reference\ =\ value\_type;}
\DoxyCodeLine{00785\ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }iterator\_category\ =\ std::forward\_iterator\_tag;}
\DoxyCodeLine{00786\ }
\DoxyCodeLine{00787\ \ \ \ \ \ \ \ \ Iterator()\ noexcept\ :\ m\_CurrentNode(\textcolor{keyword}{nullptr}),\ m\_CurrentIndex(0)\ \{\}}
\DoxyCodeLine{00788\ }
\DoxyCodeLine{00789\ \ \ \ \ \ \ \ \ reference\ operator*\ ()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00790\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \&kv\ =\ m\_CurrentNode-\/>entries[m\_CurrentIndex];}
\DoxyCodeLine{00791\ }
\DoxyCodeLine{00792\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \{\ kv.first,\ kv.second\ \};}
\DoxyCodeLine{00793\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00794\ }
\DoxyCodeLine{00795\ \ \ \ \ \ \ \ \ Iterator\&\ operator++\ ()\ \{}
\DoxyCodeLine{00796\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!m\_CurrentNode)\ \{}
\DoxyCodeLine{00797\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00798\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00799\ }
\DoxyCodeLine{00800\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (++m\_CurrentIndex\ >=\ m\_CurrentNode-\/>entries.size())\ \{}
\DoxyCodeLine{00801\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_CurrentNode\ =\ m\_CurrentNode-\/>nextLeaf;}
\DoxyCodeLine{00802\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m\_CurrentIndex\ =\ 0;}
\DoxyCodeLine{00803\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00804\ }
\DoxyCodeLine{00805\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00806\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00807\ }
\DoxyCodeLine{00808\ \ \ \ \ \ \ \ \ Iterator\ operator++\ (\textcolor{keywordtype}{int})\ \{}
\DoxyCodeLine{00809\ \ \ \ \ \ \ \ \ \ \ \ \ Iterator\ tmp\ =\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00810\ }
\DoxyCodeLine{00811\ \ \ \ \ \ \ \ \ \ \ \ \ ++*\textcolor{keyword}{this};}
\DoxyCodeLine{00812\ }
\DoxyCodeLine{00813\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ tmp;}
\DoxyCodeLine{00814\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00815\ }
\DoxyCodeLine{00816\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ operator==\ (Iterator\ \textcolor{keyword}{const}\&\ o)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00817\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ m\_CurrentNode\ ==\ o.m\_CurrentNode\ \&\&\ m\_CurrentIndex\ ==\ o.m\_CurrentIndex;}
\DoxyCodeLine{00818\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00819\ }
\DoxyCodeLine{00820\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ operator!=\ (Iterator\ \textcolor{keyword}{const}\&\ o)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00821\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ !(*\textcolor{keyword}{this}\ ==\ o);}
\DoxyCodeLine{00822\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00823\ }
\DoxyCodeLine{00824\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00825\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}*\ m\_CurrentNode;}
\DoxyCodeLine{00826\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ m\_CurrentIndex;}
\DoxyCodeLine{00827\ }
\DoxyCodeLine{00828\ \ \ \ \ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }BTree;}
\DoxyCodeLine{00829\ \};}
\DoxyCodeLine{00830\ }
\DoxyCodeLine{00831\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00832\ \textcolor{keyword}{typename}\ \mbox{\hyperlink{class_b_tree_1_1_iterator}{BTree<Key,\ Value,\ Compare>::Iterator}}\ \mbox{\hyperlink{class_b_tree_a150e650122b9926ad7bcfcacda0046d8}{BTree<Key,\ Value,\ Compare>::begin}}()}
\DoxyCodeLine{00833\ \{}
\DoxyCodeLine{00834\ \ \ \ \ \mbox{\hyperlink{class_b_tree_1_1_iterator}{Iterator}}\ it;}
\DoxyCodeLine{00835\ \ \ \ \ \mbox{\hyperlink{struct_b_tree_1_1_node}{Node}}*\ n\ =\ m\_Root;}
\DoxyCodeLine{00836\ }
\DoxyCodeLine{00837\ \ \ \ \ \textcolor{keywordflow}{while}\ (n\ \&\&\ !n-\/>isLeaf)\ \{}
\DoxyCodeLine{00838\ \ \ \ \ \ \ \ \ n\ =\ n-\/>children.front();}
\DoxyCodeLine{00839\ \ \ \ \ \}}
\DoxyCodeLine{00840\ }
\DoxyCodeLine{00841\ \ \ \ \ it.m\_CurrentNode\ =\ n;}
\DoxyCodeLine{00842\ \ \ \ \ it.m\_CurrentIndex\ =\ 0;}
\DoxyCodeLine{00843\ }
\DoxyCodeLine{00844\ \ \ \ \ \textcolor{keywordflow}{return}\ it;}
\DoxyCodeLine{00845\ \}}
\DoxyCodeLine{00846\ }
\DoxyCodeLine{00847\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Value,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00848\ \textcolor{keyword}{typename}\ \mbox{\hyperlink{class_b_tree_1_1_iterator}{BTree<Key,\ Value,\ Compare>::Iterator}}\ \mbox{\hyperlink{class_b_tree_a0346e361fbb10fa5827c8c00a9cea2e1}{BTree<Key,\ Value,\ Compare>::end}}()\ noexcept}
\DoxyCodeLine{00849\ \{}
\DoxyCodeLine{00850\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_b_tree_1_1_iterator}{Iterator}}();}
\DoxyCodeLine{00851\ \}}
\DoxyCodeLine{00852\ }

\end{DoxyCode}
